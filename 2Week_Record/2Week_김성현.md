## Title: [2Week] 김성현

### 미션 요구사항 분석 & 체크리스트

---
## 📝1주차 미션 요약

### **필수과제**

- 주문, 결제, 장바구니, PG연동

### **추가과제**

- 환불

## ✅체크리스트

Spring boot + gradle + data JPA + Spring Security + mysql + ajax + Thymeleaf 

---
## commit message
"feat:  게시판 CRUD  #1

- 더티체킹, ajax를 이용한 crud 구현
- 글 리스팅, 작성, 삭제, 수정까지 작성완료
- 리스팅을 제외한 기능에서 이슈 해결중"

### ISSUE message
### 목적
> Spring Security로 회원가입 구현

### 작업 상세사항
- [x] 도서 리스팅
- [x] 도서 장바구니 페이지
- [x] 장바구니 담기 시 DB에 저장
- [x] 결제 페이지
- [x] 결제 선택시 pg페이지 이동

2주차
### 도서목록 페이지
- [x] DB에 있는 도서목록 리스팅

### 도서 상세보기 페이지
- [x] 도서제목, 개수 선택
- [x] 장바구니 담기 기능

### 장바구니 페이지
- [x] 장바구니에 담긴 도서목록 리스팅
- [ ] 취소 기능
- [x] 주문하기 버튼 시 결제 페이지로

### 결제 페이지
- [x] 결제할 도서 리스팅
- [x] 취소 기능
- [x] 결제가격 보여주기
- [x] 결제하기 버튼 시 PG페이지로

### 추가 기능
- [x] pg연동

---
## **[접근 방법]**

**과제 목표**
1. 코드와 git의 통일성 지키기.
2. 계획한 필수 기능 구현.
3. 기능 구현 후 이슈 단위로 개선할 점 피드백하기. + (참고, 설명, 리펙터링)    

### 주문프로세스

도서목록-(장바구니담기)-장바구니-(주문하기)-주문-(결제하기)-결제

1. 주문조회는 결제가 완료되었거나 취소된 항목만 보여준다.
2. 결제처리에서 id는 Order에 대한 것이라 생각했다. Order에 결제가 완료된 것에 한해 데이터가 담긴다. 그 후 취소가 가능하다.

---
### 이슈정리

1. 장바구니 사용 시 저장된 쿠키값 유효성을 체크해서 사용권한을 구분해주려고 했다. 하지만 쿠키값을 생성하는 로직은 spring security를 사용하지 않았을 때만 작동했다. JSessionID가 있기 때문에 이를 가지고 세션구분을 해주는게 나았을 것이다. 해당 코드를 제외하고 일단 개발을 진행했다.
-> 전에 만들어둔 @AuthenticationPrincipal로 커스텀 어노테이션을 만든 후 세션정보를 가져와 쿠키값을 생성해주었다.(해결)
https://sol-devlog.tistory.com/3

2. 2주차 미션에서 주어진 ERD를 부분적으로 수정했다. MyBook 테이블의 경우, 전체 Book(해당 프로젝트의 Product)에서 username(아이디)이 같은 것만 가져오는 것으로 대체했다. cashLog와 주문품목 테이블 사이에 실제 판매가, 변동가격은 구현하기에 어려움이 있었다. 컬럼에서 많은 부분을 생략했으며, 세개의 테이블을 주문 테이블로 합쳤다.

3. 주문 데이터를 테이블에 담는 것이 아닌 별도의 클래스에 담았다.

4. 결제하기를 누르면 카카오페이 결제창으로 넘어가기 전에 다음과 같은 오류메세지가 발생했다. 400 Bad Request: "{"msg":"approve_url(http://localhost:8080/6/paySuccess) does not match registered website domain.","code":-799}"
-> 카카오페이 애플리케이션에서 web으로 도메인 등록으로 해결.

---
### 느낀 점과 아쉬운 점.

이번 2주차 과제는 주문프로세스를 적용하는 내용이었다. 해커톤 진행 당시에 비슷한 문제를 팀원들과 같이 고민했던 경험이 도움되었다.
과제에서 제시한 주문품목테이블의 변동가격, 도매가 등 실무에서 생길법한 상황을 가정해서 문제를 풀어내기에는 어려움이 있어 ERD 내용을 바꿨다.
주문테이블에 담기 전 dto에 담기고 이를 결제하면 Order테이블에 추가되도록 했다. 이 과정에서 api가 조금 달라졌다.
결제기능을 구현하기 위해 카카오페이를 연동하는 것도 전에 단편적으로 시도만 했었다. 내코드에 적용해보면서 그와 관련된 이슈도 경험하고 지식이 쌓였다.
